#!/bin/bash

### Seed Dotfiles Managment ###

################################################

################################################
# Vars
SDM_WORK_DIR=$(dirname $0)

################################################
# Functions
# Checkl if a function exist
f_exist() {
    local function_name="$1"
    type -t "$function_name" >/dev/null
}

################################################

# allowed commands, functions and  doc
command_list=(
    "help:help_msg:Show this help message"
    "setups:run_setup:Run a setup scripts"
    "install:run_install:Run the installation rutine"
)

################################################
##
# check if alerts is used
if ! f_exist "a_title"; then
    source "$SDM_WORK_DIR/../utils/alert.sh"
fi
# check if test exist
if ! f_exist "verify_commands"; then
    source "$SDM_WORK_DIR/../utils/test.sh"
fi
################################################

a_dialog "SDM" "··"

################################################
# Function to print help message
help_msg() {
    a_action "Available commands:"
    for command in "${command_list[@]}"; do
        IFS=":" read -r cmd_name cmd_func cmd_desc <<<"$command"
        a_info "\t${BOLD}$cmd_name${RESET} - ${ITALIC}$cmd_desc${RESET}"
    done
}

# Installation rutin
run_install() {
    util_user_scripts
}

# Util to link scripts
util_user_scripts() {
    a_action "Link user scripts"

    a_action "Check '~/.local/bin' in \$PATH"
    local search_path="~/.local/bin"
    local found=false
    IFS=":" read -r path_list <<<"$PATH"
    for single_path in "${path_list[@]}"; do
        if [ "$single_path" == "$search_path" ]; then
            found=true
            a_success "Path found"
            break
        fi
    done
    if ! $found; then
        a_warning "Path not found"
    fi
    echo $PATH

    a_decrease ## PATH

    a_decrease
}

################################################
runner() {
    local command="$1"
    local found=false

    for cmd in "${command_list[@]}"; do
        IFS=':' read -r cmd_name cmd_function _ <<<"$cmd"
        if [ "$cmd_name" == "install" ]; then
            "$cmd_function"
            found=true
            break
        fi
    done

    if ! $found; then
        a_error "Invalid '$1' command. "
        help_msg
        exit 1
    fi
}
################################################

if [ -z "$1" ]; then
    help_msg
    exit
fi

runner "$1"
